from github import Github
import requests
from assets.controller import GITHUB_ACCESS_TOKEN


  
def search_github_poc_exploit(keyword):
    
    g = Github(GITHUB_ACCESS_TOKEN)
    query = ''+keyword+'+in:readme+in:description'
    result = g.search_repositories(query, 'stars', 'desc')
 
    if result.totalCount < 1 : 
        return "No exploit has been published on github at this moment"
    
    PocExploit = ""
    PocExploit += "Best Poc exploit from Github : \n"#+str(result.totalCount)+"repo(s) found"
    i = 0
    for repo in result:
        PocExploit += ""+repo.clone_url+" , "+str(repo.stargazers_count)+"\n"
        i = i + 1 
        if i > 10 :
            return PocExploit
    return PocExploit

    
def searchPoCExploitWithSploitus(cve) : 

    params={"type":"exploits","sort":"default","query":cve,"title":"true","offset":0}
    response = requests.post('https://sploitus.com/search', json=params)
    data = response.json() # Check the JSON Response Content documentation below
    
    if data['exploits_total'] < 1 : 
        return "Unfortunately, 0 PoC exploit has been found with sploitus.com"

    output = ""
    for exploit in data['exploits']:
        output +=  exploit['title']+"\n"
        output += exploit['href']+"\n"
        output += "Published :"+ exploit['published']+"\n"
    return output

