from github import Github
import requests
from assets.controller import *
from assets.functions import * 

  
def searchPoCExploitOnlyWithGithub(keyword):
    
    g = Github(GITHUB_TOKEN_READ_ONLY_PUBLIC_REPOSITORY)
    query = ''+keyword+'+in:readme+in:description'
    result = g.search_repositories(query, 'stars', 'desc')
 
    if result.totalCount < 1 : 
        return "No exploit has been published on github at this moment."
    
    PocExploit = ""
    PocExploit += "Best Poc exploit from Github : \n"#+str(result.totalCount)+"repo(s) found"
    i = 0
    for repo in result:
        PocExploit += "ðŸ”— <a href='"+repo.clone_url+"'>Link</a> - "+str(repo.stargazers_count)+"â­\n"
        i = i + 1 
        if i > 10 :
            return PocExploit
    return PocExploit

    
def searchPoCExploitWithSploitus(cve) : 

    params={"type":"exploits","sort":"default","query":cve,"title":"true","offset":0}
    response = requests.post('https://sploitus.com/search', json=params)
    data = response.json() # Check the JSON Response Content documentation below
    
    if data['exploits_total'] < 1 : 
        return "Unfortunately, 0 PoC exploit has been found."

    output = ""

    for exploit in data['exploits']:
        if len(exploit['href']) == 0 :
            return "âŒðŸ”— Broken PoC Link ðŸ˜”"
        output += "ðŸ”¹"+exploit['title']+"\n"
        output += "    ðŸ”—<a href='"+exploit['href']+"'>Link </a>\n"
        output += "    ðŸ—“Published :"+ exploit['published']+"\n\n"
    return output

